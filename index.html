<script>
// --- CINTURÓN DE SEGURIDAD: Espera a que la página cargue por completo ---
document.addEventListener('DOMContentLoaded', () => {

    const chatContainer = document.getElementById('chat');
    const inputForm = document.getElementById('input-form');
    const inputField = document.getElementById('input');

    const API_URL = 'https://mi-api-ia.onrender.com/chat';

    function addMessage(content, isUser) {
        const messageDiv = document.createElement('div');
        messageDiv.className = isUser ? 'user-message' : 'ai-message';
        messageDiv.textContent = content;
        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    inputForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const userMessage = inputField.value;
        if (!userMessage) return;

        addMessage(`Tú: ${userMessage}`, true);
        inputField.value = '';
        inputField.disabled = true;

        try {
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ messages: [{ role: 'user', content: userMessage }] }),
            });

            if (!response.ok) {
                throw new Error(`Error de red: ${response.status} ${response.statusText}`);
            }

            const data = await response.json();
            addMessage(`IA: ${data.response}`, false);
        } catch (error) {
            console.error("Error detallado al conectar con la API:", error);
            addMessage('IA: Error al conectar con la API.', false);
        } finally {
            inputField.disabled = false;
            inputField.focus();
        }
    });

}); // --- FIN DEL CINTURÓN DE SEGURIDAD ---
</script>